(function(a,b){a.namespace("REFINERYCMS.dialog");a.dialog.LinkDialog=function(c){this.name="LinkDialog";this.version="0.1";this.callback=c||null;this.init();};a.dialog.LinkDialog.prototype={validation_rules:{"your_page":{},"email_address":{"email_address_text":[{"op":":filled","msg":"Email must be filled"},{"op":":email","msg":"Email is not valid"}]},"web_address":{"web_address_text":[{"op":":filled","msg":"Location must be filled"},{"op":":url","msg":"Location is not valid"}]},"resource_address":{}},submit_link_choice:function(){$(parent.document.getElementById("wym_dialog_submit")).click();},resource_tab:function(){},page_tab:function(){var c=this;$("#pages_list").delegate("li","click",function(h){var i=$(this),g=i.children("a.page_link").get(0),d=(b.location.port.length>0?(":"+b.location.port):""),f=g.href.replace(b.location.protocol+"//"+b.location.hostname+d,"");h.preventDefault();$("li.linked").removeClass("linked");i.addClass("linked");c.set_wym_values(f,g.rel.replace(/\ ?<em>.+?<\/em>/,""));});},web_tab:function(){var d=this,c=$("#web_address_text"),e=$("#web_address_target_blank"),g=this.validation_rules.web_address||{},f=function(k){var l=c.val(),j=(!g[this.id]||a.form.validateControl(this,g[this.id],true))?true:false,i=j?"success_icon":"failure_icon";if(typeof(g[this.id])!=="undefined"){$("#"+this.id.replace("_text","_test_result")).removeClass().addClass(i).show();}if(j){d.set_wym_values(l,l,(e.checked?"_blank":""));if(typeof(g[this.id])!=="undefined"){var h=$("#"+this.id.replace("_text","_test_result"));if(h.length===0){$(this).after('<span id="'+this.id.replace("_text","_test_result")+'"></span>');h=$("#"+this.id.replace("_text","_test_result"));}h.removeClass().addClass(i).show();}}};c.keyup(f);c.change(f);e.click(function(){parent.document.getElementById("wym_target").value=this.checked?"_blank":"";});},email_tab:function(){var c=this,e=this.validation_rules.email_address||{},d=function(m){var g=$("#email_default_subject_text").val(),l=$("#email_default_body_text").val(),h="mailto:"+$("#email_address_text").val(),f="?",k=(!e[this.id]||a.form.validateControl(this,e[this.id],true))?true:false,j=k?"success_icon":"failure_icon";if(typeof(e[this.id])!=="undefined"){var i=$("#"+this.id.replace("_text","_test_result"));i.removeClass().addClass(j).show();}if(k){if(g.length>0){h+=f+"subject="+g;f="&";}if(l.length>0){h+=f+"body="+l;f="&";}c.set_wym_values(h,h.replace("mailto:",""));}};$("#email_address_text, #email_default_subject_text, #email_default_body_text").keyup(d);$("#email_address_text, #email_default_subject_text, #email_default_body_text").change(d);},set_wym_values:function(c,h,f){if(parent){var d=parent.document.getElementById("wym_href"),g=parent.document.getElementById("wym_title"),e=parent.document.getElementById("wym_target");f=f||null;if(d!==null&&c!==null){d.value=c;}if(g!==null&&h!==null){g.value=h;}if(e!==null&&f!==null){e.value=f;}}},disable_submit:function(){this.submit_button.attr("disabled",true).addClass("disabled");},enable_submit:function(){this.submit_button.attr("disabled",false).removeClass("disabled");},init_submit_button:function(){var c=this;this.submit_button.click(function(d){c.submit_loader_off();if(c.validate_active_tab()){c.submit_loader_on();c.submit_link_choice();}});},init:function(){try{this.submit_button=$("#submit_button");this.page_tab();this.web_tab();this.email_tab();this.resource_tab();this.init_tabs();this.init_submit_button();this.initialised=true;}catch(c){console.log(c);}}};a.extendObject(a.dialog.LinkDialog,a.Dialog);}(REFINERYCMS,window));